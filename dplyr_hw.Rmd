---
title: "dplyr homework"
author: "VP Nagraj"
date: "January 27, 2016"
output: 
  html_document: 
    keep_md: yes
---

# **dplyr** homework

## Key Concepts
> 
- **dplyr** verbs
- le pipe `%>%`
- the `tbl_df`
- window functions
- summary functions
- variable creation
- aggregation
- multiple conditions
- properties of grouped data

```{r init, echo=FALSE}
library(knitr)
opts_chunk$set(message=FALSE, warning=FALSE, eval=TRUE, echo=FALSE, fig.keep="none")
```

## Getting Started

Load the **dplyr** and **readr** packages, and read the gapminder data into R using the `read_csv()` function. 

Make sure you store the results in an object called `gm`

**n.b. `read_csv()` is *not* the same as `read.csv()`**

```{r loaddata, echo=TRUE}
library(dplyr)
library(readr)

gm <- read_csv("data/gapminder.csv")
gm
```

## Problem Set

Use **dplyr** functions to address the following questions:

1) How many unique countries are represented per continent?

```{r problem1}
gm %>%
    distinct(country) %>%
    group_by(continent) %>%
    summarise(n = n())
```

2) Which European nation had the lowest GDP per capita in 1997? 

```{r problem2}
gm %>%
    filter(continent == "Europe" & year == 1997) %>%
    arrange(gdpPercap) %>%
    head(1)
```

3) According to the data available, what was the average life expectancy across each continent in the 1980s?

```{r problem3}
gm %>%
    filter(year == 1982 | year == 1987) %>%
    group_by(continent) %>%
    summarise(mean.lifeExp = mean(lifeExp))
```

4) What 5 countries have the highest total GDP over all years combined?

```{r problem4}
gm %>%
    mutate(gdp = gdpPercap*pop) %>%
    group_by(country) %>%
    summarise(Total.GDP = sum(gdp)) %>%
    arrange(desc(Total.GDP)) %>%
    head(5)
```

5) What countries and years had life expectancies of _at least_ 80 years? 

**n.b. only output the columns of interest: country, life expectancy and year (in that order)**

```{r problem5}
gm %>%
    filter(lifeExp >= 80) %>%
    select(country, lifeExp, year)
```

6) What 10 countries have the strongest correlation (in either direction ... ) between life expectancy and per capita GDP?

```{r problem6}
gm %>%
    group_by(country) %>%
    summarise(r = abs(cor(lifeExp, gdpPercap))) %>%
    arrange(desc(r)) %>%
    head(10)
```

7) Which combinations of continent (besides Asia) and year have the highest average population across all countries?

**n.b. your output should include all results sorted by highest average population**

```{r problem7}
gm %>%
    filter(continent != "Asia") %>%
    group_by(continent, year) %>%
    summarise(mean.pop = mean(pop)) %>%
    ungroup() %>%
    arrange(desc(mean.pop)) 
```


8) What 3 countries have had the most consistent population estimates (i.e. lowest standard deviation) across the years of available data? 

```{r problem8}
gm %>%
    group_by(country) %>%
    summarise(sd.pop = sd(pop)) %>%
    arrange(sd.pop) %>%
    head(3)
```

9) Excluding records from 1952, which observations indicate that the population of a country has *decreased* from the previous year **and** the life expectancy has *increased*.

```{r problem9}
gm %>%
    filter(year!=1952 & pop < lag(pop) & lifeExp > lag(lifeExp))
```

10) Subset *gm* to only include observations from 1992 and store the results as  *gm1992*. What kind of object is this?

```{r problem10}
gm1992 <-
    gm %>%
    filter(year == 1992)

gm1992 %>% 
    class()
```